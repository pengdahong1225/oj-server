syntax = "proto3";
option go_package = "./;pb";

// 题目基础信息
message Problem{
  int64 id = 1;
  int64 create_at = 2;
  int64  update_at = 3;
  string delete_at = 4;

  string title = 5;
  string description = 6;
  int32 level = 7;
  repeated string tags = 8;
  int32 status = 9;
}
// 题目配置信息
message ProblemConfig{
  int64 id = 1;
  Limit compile_limit = 2;
  Limit run_limit = 3;
  repeated TestCase test_cases = 4;
}
message Limit{
  int64 cpu_limit = 1;    // CPU时间限制，单位纳秒
  int64 clock_limit = 2;  // 等待时间限制，单位纳秒 （通常为 cpuLimit 两倍）
  int64 memory_limit = 3; // 内存限制，单位 byte
  int64 stack_limit = 4;  // 栈内存限制，单位 byte
  int64 proc_limit = 5;   // 线程数量限制
}
message TestCase{
  string input = 1;
  string output = 2;
}

// “提交”状态枚举，如果没有查询到状态，就意味着最近没有提交题目or题目提交过期了
enum SubmitState{
  UPStateNormal = 0;        // 初始状态
  UPStateCompiling = 1;     // 正在编译
  UPStateJudging = 2;       // 已编译成功，正在判题
  UPStateExited = 3;        // 已退出 -> 如何查询到这个状态，意味着可以查询结果了
}

// 题目服务->判题服务
message JudgeSubmission{
  int64 problem_id = 1;
  string title = 2;
  string lang = 3;
  string code = 4;
  int64 uid = 5;
  string config_url = 6;
  string task_id = 7;
  int32 level = 8;
}

// 判题服务->题目服务
message JudgeResult{
  repeated JudgeResultItem items = 1;
  int64 uid = 2;
  int64 problem_id = 3;
  bool accepted = 4;
  string message = 5;
  string code = 6;
  string lang = 7;
  string task_id = 8;
  int32 level = 9;
}

message JudgeResultItem{
  // api返回字段
  string status = 1;
  string err_msg = 2;                // 详细错误信息
  int64 exitStatus = 3;              // 程序返回值
  int64 time = 4;                    // 程序运行 CPU 时间，单位纳秒
  int64 memory = 5;                  // 程序运行内存，单位 byte
  int64 runTime = 6;                 // 程序运行现实时间，单位纳秒
  // 其他字段
  string content = 7;
  TestCase testCase = 8;
}
message JudgeResultStore {
  repeated JudgeResultItem items = 1;
}
